stages:
- name: docker
- name: deploy
  if: branch = master AND type = push

jobs:
  include:
  - stage: docker
    name: "Build Backend Docker image"
    services: docker
    before_script:
    - cd WIS/backend
    script:
    - docker build -t wis-backend .
    before_deploy:
    - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
    deploy:
      provider: script
      script: docker push
      on:
        branch: master

  - stage: docker
    name: "Build Frontend Docker image"
    services: docker
    before_script:
    - cd WIS/web
    script:
    - docker build -t wis-frontend .
    before_deploy:
    - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
    deploy:
      provider: script
      script: docker push
      on:
        branch: master

  - stage: deploy
    name: "Trigger new Deployment"
    script:
    - curl "$DEPLOYMENT_TRIGGER_URL"
    